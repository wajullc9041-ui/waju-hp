<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>WaJu - 公開ページ</title>
  <meta name="color-scheme" content="light dark">
  <style>
    :root{--container:1120px}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial,'Noto Sans JP','Hiragino Kaku Gothic ProN',Meiryo,sans-serif;color:#0f172a;background:#fff}
    a{color:inherit;text-decoration:none}
    main{min-height:40vh}
    .container{max-width:var(--container);margin:0 auto;padding:16px}
    .hfbar{display:flex;align-items:center;gap:var(--gap,16px)}
    .hfbar.hf-row{justify-content:flex-start}
    .hfbar.hf-column{flex-direction:column;align-items:stretch}
    .hf-brand{display:flex;align-items:center;gap:8px}
    .hf-nav{display:flex;gap:var(--gap,16px);flex-wrap:wrap;width:100%}
    .slot{display:flex;align-items:center}
    .slot.brand{flex:0 0 auto}
    .slot.nav{flex:1 1 auto}
    .hf-copy{display:flex;width:100%}
    /* demo content */
    .dummy{background:#f8fafc;border:1px solid #e2e8f0;border-radius:12px;padding:24px;margin:16px auto}
    @media (max-width:640px){
      .container{padding:12px}
      :root{--container:100%}
    }
  </style>
</head>
<body>
  <div id="site-header"></div>
  <main id="page-content">
    <div class="container">
      <div class="dummy">
        <h2>ダミーセクション</h2>
        <p>ここにページ編集の内容が反映されます（フック用意済み）。</p>
      </div>
    </div>
  </main>
  <div id="site-footer"></div>

  <script type="module">
    const { createClient } = await import("https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm");
    const sb = createClient(
      "https://htnmjsqgoapvuanrsuma.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0bm1qc3Fnb2FwdnVhbnJzdW1hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzI3MDEsImV4cCI6MjA3MDkwODcwMX0.1AACTWZmChfmIIfBad0sf-hLV2bnaUt7bVURXnd0uKA"
    );
    const $ = s => document.querySelector(s);
    const toJustify = p => p==='left'?'flex-start':p==='right'?'flex-end':'center';
    const num = (v,f)=>{const n=Number(v);return Number.isFinite(n)&&n>0?n:f};
    const withFallback = s => !s ? "" : (/\b(sans-serif|serif|monospace)\b/i.test(s) ? s : `${s}, sans-serif`);
    const bgParts = (row, def) => (row.bg_gradient && row.bg_gradient.trim())
        ? {bgColor:def, bgImage:row.bg_gradient}
        : {bgColor:(row.bg_color && row.bg_color.trim())?row.bg_color:def, bgImage:"none"};

    async function load(){
      const [{data:menus},{data:hdr},{data:ftr}] = await Promise.all([
        sb.from("public_menus").select("*").order("sort_order", {ascending:true}),
        sb.from("hf_settings").select("*").eq("area","header").single(),
        sb.from("hf_settings").select("*").eq("area","footer").single()
      ]);
      renderHeader(hdr||{}, menus||[]);
      renderFooter(ftr||{}, menus||[]);
      adjustOffsets(hdr||{}, ftr||{});
      window.addEventListener('resize', ()=>adjustOffsets(hdr||{}, ftr||{}));
    }

    function renderHeader(d, menus){
      const items = (menus||[]).filter(m=>m.is_active && m.show_in_header).map(m=>`<a href="${m.href||'#'}">${m.title}</a>`).join("");
      const {bgColor,bgImage} = bgParts(d, "#0f172a");
      const ff = d.header_font_family ? `font-family:${withFallback(d.header_font_family)};` : "";
      const cls = d.layout_mode==="column" ? "hfbar hf-column" : "hfbar hf-row";
      $("#site-header").innerHTML = `
        <div class="${cls}" style="${ff}
            --gap:${num(d.link_spacing,16)}px;
            background-color:${bgColor} !important;
            background-image:${bgImage==='none'?'none':bgImage} !important;
            height:${num(d.bar_height,60)}px; padding:${d.padding||'8px 12px'};">
          <div class="slot brand" style="${d.company_alignment==='left'?'margin-right:auto':d.company_alignment==='center'?'margin:0 auto':'margin-left:auto'}">
            <div class="hf-brand">
              ${d.logo_url?`<img src="${d.logo_url}" alt="logo" onerror="this.style.display='none'" style="max-height:${num(d.logo_height||d.bar_height,60)}px">`:""}
              <span style="color:${d.company_color};font-weight:${d.company_weight};font-size:${num(d.header_company_size,18)}px">${d.company_name||""}</span>
            </div>
          </div>
          <div class="slot nav">
            <nav class="hf-nav" style="justify-content:${toJustify(d.nav_alignment)};color:${d.nav_color};font-weight:${d.nav_weight};font-size:${num(d.header_nav_size,14)}px">${items}</nav>
          </div>
        </div>`;
      if(d.header_fixed){ const el=$("#site-header").firstElementChild; el.style.position="sticky"; el.style.top="0"; el.style.zIndex="5"; }
    }

    function renderFooter(d, menus){
      const items = (menus||[]).filter(m=>m.is_active && m.show_in_footer).map(m=>`<a href="${m.href||'#'}">${m.title}</a>`).join("");
      const {bgColor,bgImage} = bgParts(d, "#0f172a");
      const ff = d.footer_font_family ? `font-family:${withFallback(d.footer_font_family)};` : "";
      const cls = d.layout_mode==="row" ? "hfbar hf-row" : "hfbar hf-column";
      const inner = d.layout_mode==="row"
        ? `<div class="hf-copy" style="color:${d.footer_color};font-weight:${d.footer_weight||'normal'};justify-content:${toJustify(d.footer_alignment)};font-size:${num(d.footer_copy_size,14)}px">${d.footer_text||""}</div>
           <nav class="hf-nav" style="justify-content:${toJustify(d.nav_alignment_footer)};color:${d.nav_color_footer};font-weight:${d.nav_weight_footer};font-size:${num(d.footer_nav_size,14)}px">${items}</nav>`
        : (d.layout_mode==="nav-top"
          ? `<nav class="hf-nav" style="justify-content:${toJustify(d.nav_alignment_footer)};color:${d.nav_color_footer};font-weight:${d.nav_weight_footer};font-size:${num(d.footer_nav_size,14)}px">${items}</nav>
             <div class="hf-copy" style="color:${d.footer_color};font-weight:${d.footer_weight||'normal'};justify-content:${toJustify(d.footer_alignment)};font-size:${num(d.footer_copy_size,14)}px">${d.footer_text||""}</div>`
          : `<div class="hf-copy" style="color:${d.footer_color};font-weight:${d.footer_weight||'normal'};justify-content:${toJustify(d.footer_alignment)};font-size:${num(d.footer_copy_size,14)}px">${d.footer_text||""}</div>
             <nav class="hf-nav" style="justify-content:${toJustify(d.nav_alignment_footer)};color:${d.nav_color_footer};font-weight:${d.nav_weight_footer};font-size:${num(d.footer_nav_size,14)}px">${items}</nav>`);
      $("#site-footer").innerHTML = `
        <div class="${cls}" style="${ff}
            --gap:${num(d.link_spacing,16)}px;
            background-color:${bgColor} !important;
            background-image:${bgImage==='none'?'none':bgImage} !important;
            height:${num(d.bar_height,60)}px; padding:${d.padding||'8px 12px'};">
          ${inner}
        </div>`;
      if(d.footer_fixed){ const el=$("#site-footer").firstElementChild; el.style.position="fixed"; el.style.left="0"; el.style.right="0"; el.style.bottom="0"; }
    }

    function adjustOffsets(hdr, ftr){
      const header = $("#site-header").firstElementChild;
      const footer = $("#site-footer").firstElementChild;
      document.body.style.paddingTop = (hdr && hdr.header_fixed && header) ? header.getBoundingClientRect().height + "px" : "";
      document.body.style.paddingBottom = (ftr && ftr.footer_fixed && footer) ? footer.getBoundingClientRect().height + "px" : "";
    }

    load();
  </script>
</body>
</html>
