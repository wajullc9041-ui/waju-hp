
<!-- 管理メニュー管理 -->
<div class="container mt-4">
  <h2>管理メニュー管理</h2>
  <div class="form-group">
    <label for="displayName">表示名：</label>
    <input type="text" id="displayName" class="form-control" />
  </div>
  <div class="form-group">
    <label for="htmlLink">リンク先HTML：</label>
    <input type="text" id="htmlLink" class="form-control" />
  </div>
  <div class="form-group">
    <label for="order">順番（数字）：</label>
    <input type="number" id="order" class="form-control" />
  </div>
  <div class="form-group form-check">
    <input type="checkbox" id="isPublished" class="form-check-input" />
    <label class="form-check-label" for="isPublished">公開状態</label>
  </div>
  <button id="addButton" class="btn btn-primary">追加</button>

  <table class="table mt-4">
    <thead class="thead-light">
      <tr>
        <th>表示名</th>
        <th>HTML</th>
        <th>順番</th>
        <th>公開</th>
      </tr>
    </thead>
    <tbody id="menuTableBody"></tbody>
  </table>
</div>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

  const supabaseUrl = 'https://htnmjsqgoapvuanrsuma.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0bm1qc3Fnb2FwdnVhbnJzdW1hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzI3MDEsImV4cCI6MjA3MDkwODcwMX0.1AACTWZmChfmIIfBad0sf-hLV2bnaUt7bVURXnd0uKA';
  const supabase = createClient(supabaseUrl, supabaseKey);

  document.addEventListener('DOMContentLoaded', async () => {
    const tableBody = document.getElementById("menuTableBody");

    async function loadMenus() {
      const { data, error } = await supabase
        .from('admin_menu')
        .select('*')
        .order('sort_order', { ascending: true });

      tableBody.innerHTML = '';
      if (error) {
        const row = document.createElement('tr');
        row.innerHTML = `<td colspan="4">読み込みエラー: ${error.message}</td>`;
        tableBody.appendChild(row);
        return;
      }

      data.forEach((item) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.label}</td>
          <td>${item.html}</td>
          <td>${item.sort_order}</td>
          <td>${item.is_published ? '✓' : ''}</td>
        `;
        tableBody.appendChild(row);
      });
    }

    document.getElementById('addButton').addEventListener('click', async () => {
      const label = document.getElementById('displayName').value.trim();
      const html = document.getElementById('htmlLink').value.trim();
      const sort_order = parseInt(document.getElementById('order').value, 10);
      const is_published = document.getElementById('isPublished').checked;

      if (!label || !html || isNaN(sort_order)) {
        alert("全項目を正しく入力してください");
        return;
      }

      const { error } = await supabase.from('admin_menu').insert([{ label, html, sort_order, is_published }]);
      if (error) {
        alert("追加に失敗しました: " + error.message);
        return;
      }

      document.getElementById('displayName').value = '';
      document.getElementById('htmlLink').value = '';
      document.getElementById('order').value = '';
      document.getElementById('isPublished').checked = false;

      await loadMenus();
    });

    await loadMenus();
  });
</script>
