
<div class="container">
  <h2>管理メニュー管理</h2>
  <div class="form-group">
    <label for="menu_name">表示名：</label>
    <input type="text" id="menu_name" />
  </div>
  <div class="form-group">
    <label for="menu_html">リンク先HTML：</label>
    <input type="text" id="menu_html" />
  </div>
  <div class="form-group">
    <label for="menu_order">順番（数字）：</label>
    <input type="number" id="menu_order" />
  </div>
  <div class="form-group">
    <label><input type="checkbox" id="menu_publish" /> 公開状態</label>
  </div>
  <button id="addBtn">追加</button>

  <table id="menuTable">
    <thead>
      <tr><th>表示名</th><th>HTML</th><th>順番</th><th>公開</th></tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<style>
  .container {
    padding: 20px;
    font-family: sans-serif;
  }
  .form-group {
    margin-bottom: 10px;
  }
  table {
    margin-top: 20px;
    border-collapse: collapse;
    width: 100%;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
  }
  th {
    background-color: #f0f0f0;
  }
</style>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  const supabaseUrl = 'https://htnmjsqgoapvuanrsuma.supabase.co';
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0bm1qc3Fnb2FwdnVhbnJzdW1hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzI3MDEsImV4cCI6MjA3MDkwODcwMX0.1AACTWZmChfmIIfBad0sf-hLV2bnaUt7bVURXnd0uKA';
  const supabase = createClient(supabaseUrl, supabaseKey);

  const fetchMenus = async () => {
    const { data, error } = await supabase.from('admin_menu').select('*').order('order', { ascending: true });
    if (error) {
      console.error(error);
      return;
    }
    const tbody = document.querySelector("#menuTable tbody");
    tbody.innerHTML = "";
    data.forEach(row => {
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${row.name}</td>
        <td>${row.html}</td>
        <td>${row.order}</td>
        <td>${row.publish ? "✓" : ""}</td>`;
      tbody.appendChild(tr);
    });
  };

  document.getElementById("addBtn").addEventListener("click", async () => {
    const name = document.getElementById("menu_name").value.trim();
    const html = document.getElementById("menu_html").value.trim();
    const order = parseInt(document.getElementById("menu_order").value.trim(), 10);
    const publish = document.getElementById("menu_publish").checked;

    if (!name || !html || isNaN(order)) {
      alert("すべての必須項目を入力してください");
      return;
    }

    const { error } = await supabase.from("admin_menu").insert([{ name, html, order, publish }]);
    if (error) {
      alert("追加に失敗しました");
      console.error(error);
      return;
    }

    // フォームリセットと再取得
    document.getElementById("menu_name").value = "";
    document.getElementById("menu_html").value = "";
    document.getElementById("menu_order").value = "";
    document.getElementById("menu_publish").checked = false;
    fetchMenus();
  });

  fetchMenus();
</script>
