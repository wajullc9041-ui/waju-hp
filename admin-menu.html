<div class="main-content">
  <h2 class="text-2xl font-bold mb-4">管理メニュー管理</h2>
  <form id="menuForm" class="mb-6">
    <div class="mb-2">
      <label class="block font-semibold">表示名：</label>
      <input type="text" id="name" class="border px-2 py-1 w-full">
    </div>
    <div class="mb-2">
      <label class="block font-semibold">リンク先HTML：</label>
      <input type="text" id="html" class="border px-2 py-1 w-full">
    </div>
    <div class="mb-2">
      <label class="block font-semibold">順番（数字）：</label>
      <input type="number" id="order" class="border px-2 py-1 w-full">
    </div>
    <div class="mb-2">
      <label><input type="checkbox" id="is_public"> 公開状態</label>
    </div>
    <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white font-bold py-1 px-4 rounded">追加</button>
  </form>
  <table class="table-auto w-full">
    <thead>
      <tr class="bg-gray-100">
        <th class="px-4 py-2">表示名</th>
        <th class="px-4 py-2">HTML</th>
        <th class="px-4 py-2">順番</th>
        <th class="px-4 py-2">公開</th>
      </tr>
    </thead>
    <tbody id="menuList"></tbody>
  </table>
</div>

<script>
const supabaseUrl = 'https://htnmjsqgoapvuanrsuma.supabase.co';
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0bm1qc3Fnb2FwdnVhbnJzdW1hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzI3MDEsImV4cCI6MjA3MDkwODcwMX0.1AACTWZmChfmIIfBad0sf-hLV2bnaUt7bVURXnd0uKA';
const supabase = supabase.createClient(supabaseUrl, supabaseKey);

async function fetchMenus() {
  const { data, error } = await supabase.from('admin_menu').select('*').order('order');
  if (error) {
    console.error('読み込み失敗:', error);
    return;
  }
  const menuList = document.getElementById('menuList');
  menuList.innerHTML = '';
  data.forEach(item => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td class="border px-4 py-2">${item.name}</td>
      <td class="border px-4 py-2">${item.html}</td>
      <td class="border px-4 py-2">${item.order}</td>
      <td class="border px-4 py-2 text-center">${item.is_public ? '✓' : ''}</td>
    `;
    menuList.appendChild(tr);
  });
}

fetchMenus();

document.getElementById('menuForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const name = document.getElementById('name').value;
  const html = document.getElementById('html').value;
  const order = parseInt(document.getElementById('order').value);
  const is_public = document.getElementById('is_public').checked;

  if (!name || !html || isNaN(order)) {
    alert('すべての項目を正しく入力してください');
    return;
  }

  const { error } = await supabase.from('admin_menu').insert([{ name, html, order, is_public }]);
  if (error) {
    alert('追加に失敗しました');
    console.error(error);
    return;
  }
  document.getElementById('menuForm').reset();
  fetchMenus();
});
</script>
