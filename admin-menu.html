
<div class="content-container">
  <h2>ç®¡ç†ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç®¡ç†</h2>
  <form id="menuForm" class="form-grid">
    <div class="form-row">
      <label for="title">è¡¨ç¤ºåï¼š</label>
      <input type="text" id="title" required>
    </div>
    <div class="form-row">
      <label for="filename">ãƒªãƒ³ã‚¯å…ˆHTMLï¼š</label>
      <input type="text" id="filename" required>
    </div>
    <div class="form-row">
      <label for="sort_order">é †ç•ªï¼ˆæ•°å­—ï¼‰ï¼š</label>
      <input type="number" id="sort_order" required>
    </div>
    <div class="form-row">
      <label><input type="checkbox" id="is_active"> å…¬é–‹çŠ¶æ…‹</label>
    </div>
    <div class="form-row">
      <button type="submit">è¿½åŠ </button>
    </div>
  </form>

  <table id="menuTable">
    <thead>
      <tr>
        <th>è¡¨ç¤ºå</th>
        <th>HTML</th>
        <th>é †ç•ª</th>
        <th>å…¬é–‹</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>
</div>

<script type="module">
  import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'
  const supabaseUrl = 'https://viihcgkjzzhkdiwdzdex.supabase.co'
  const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZpaWhjZ2tqenpoa2Rpd2R6ZGV4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MTIxMzUwNDksImV4cCI6MjAyNzAxMTA0OX0.0jjcgZ_EH7Ek8MBwCvgtatg1-lDFpNuFRHh14iPYjJU'
  const supabase = createClient(supabaseUrl, supabaseKey)

  const tableBody = document.querySelector('#menuTable tbody')
  const form = document.getElementById('menuForm')

  async function fetchMenus() {
    console.log('ğŸ”„ ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä¸€è¦§ã‚’å–å¾—ä¸­...')
    const { data, error } = await supabase.from('admin_menus').select('*').order('sort_order')
    if (error) {
      console.error('âŒ ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼:', error)
      return
    }

    tableBody.innerHTML = ''
    data.forEach(menu => {
      const row = document.createElement('tr')
      row.innerHTML = `
        <td>${menu.title}</td>
        <td>${menu.filename}</td>
        <td>${menu.sort_order}</td>
        <td>${menu.is_active ? 'âœ”' : ''}</td>
      `
      tableBody.appendChild(row)
    })
  }

  form.addEventListener('submit', async (e) => {
    e.preventDefault()
    const title = document.getElementById('title').value.trim()
    const filename = document.getElementById('filename').value.trim()
    const sort_order = Number(document.getElementById('sort_order').value)
    const is_active = document.getElementById('is_active').checked

    if (!title || !filename || isNaN(sort_order)) {
      alert('ã™ã¹ã¦ã®é …ç›®ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚')
      return
    }

    const { error } = await supabase.from('admin_menus').insert([{ title, filename, sort_order, is_active }])
    if (error) {
      alert('è¿½åŠ å¤±æ•—: ' + error.message)
    } else {
      alert('è¿½åŠ ã—ã¾ã—ãŸ')
      form.reset()
      await fetchMenus()
    }
  })

  fetchMenus()
</script>

<style>
  .content-container {
    padding: 20px;
    max-width: 800px;
  }
  .form-grid {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 20px;
  }
  .form-row {
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .form-row label {
    width: 140px;
    font-weight: bold;
  }
  input[type="text"], input[type="number"] {
    flex: 1;
    padding: 6px;
  }
  button {
    padding: 6px 12px;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }
  button:hover {
    background-color: #0056b3;
  }
  table {
    width: 100%;
    border-collapse: collapse;
  }
  th, td {
    padding: 10px;
    border: 1px solid #ddd;
    text-align: left;
  }
  th {
    background-color: #f2f2f2;
  }
</style>
