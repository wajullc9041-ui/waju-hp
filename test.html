<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ブログ詳細 | 合同会社WaJu</title>
  <meta name="description" content="合同会社WaJuのブログ詳細ページです。介護・福祉業界を支えるCARELAYの情報や最新記事をご覧いただけます。">

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-XXXXXXXXXX');
  </script>

  <style>
    body{font-family:"Noto Sans JP",sans-serif;margin:0;padding:0;background:#f8f9fa;}
    main{max-width:900px;margin:80px auto;padding:20px;}
    h1{font-size:1.8rem;margin-bottom:10px;}
    .meta{color:#555;font-size:0.9rem;margin-bottom:20px;}
    .thumbnail{width:100px;height:100px;object-fit:cover;border-radius:6px;margin-bottom:10px;}
    .content{background:#fff;border:1px solid #ddd;border-radius:8px;padding:20px;margin:20px 0;}
    .tags{margin-top:15px;}
    .tag{display:inline-block;background:#e9ecef;color:#333;padding:4px 10px;border-radius:12px;font-size:0.8rem;margin-right:6px;}
    .nav-links{display:flex;justify-content:space-between;align-items:center;margin:20px 0;}
    .nav-btn{display:flex;align-items:center;gap:6px;background:#0d6efd;color:#fff;padding:8px 14px;border-radius:20px;text-decoration:none;font-size:0.9rem;}
    .nav-btn:hover{opacity:0.8;}
    .share{margin:20px 0;display:flex;align-items:center;gap:10px;}
    .share span{font-size:0.9rem;}
    .share a{width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:50%;color:#fff;text-decoration:none;font-size:1rem;}
    .x{background:#000;}
    .fb{background:#1877f2;}
    .line{background:#06c755;}
    .ig{background:#e1306c;}
    .mail{background:#fbbc05;color:#000;}
  </style>
</head>
<body>
  <header id="site-header"></header>

  <main id="page-main">
    <div class="nav-links top-nav">
      <a href="#" id="prevArticle" class="nav-btn">⬅ 前の記事</a>
      <a href="/blog/" class="nav-btn">🏠 一覧に戻る</a>
      <a href="#" id="nextArticle" class="nav-btn">次の記事 ➡</a>
    </div>

    <img id="thumbnail" class="thumbnail" alt="サムネイル">
    <h1 id="title"></h1>
    <div class="meta">
      <span id="category"></span> | <span id="date"></span>
    </div>
    <div id="content" class="content"></div>

    <div class="tags" id="tags"></div>

    <div class="share">
      <span>シェアする：</span>
      <a id="shareX" class="x" target="_blank">X</a>
      <a id="shareFb" class="fb" target="_blank">f</a>
      <a id="shareLine" class="line" target="_blank">L</a>
      <a id="shareIg" class="ig" target="_blank">IG</a>
      <a id="shareMail" class="mail" target="_blank">@</a>
    </div>

    <div class="nav-links bottom-nav">
      <a href="#" id="prevArticle2" class="nav-btn">⬅ 前の記事</a>
      <a href="/blog/" class="nav-btn">🏠 一覧に戻る</a>
      <a href="#" id="nextArticle2" class="nav-btn">次の記事 ➡</a>
    </div>
  </main>

  <footer id="site-footer"></footer>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

    const supabase = createClient(
      "https://htnmjsqgoapvuanrsuma.supabase.co",
      "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0bm1qc3Fnb2FwdnVhbnJzdW1hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzI3MDEsImV4cCI6MjA3MDkwODcwMX0"
    );

    const params = new URLSearchParams(window.location.search);
    const slug = params.get("slug");

    async function loadArticle(){
      const { data, error } = await supabase.from("articles").select("*").eq("slug", slug).single();
      if(error){ console.error(error); return; }
      if(!data){ return; }

      document.getElementById("title").textContent = data.title;
      document.getElementById("date").textContent = new Date(data.created_at).toLocaleDateString();
      document.getElementById("category").textContent = data.category || "";
      document.getElementById("content").innerHTML = data.content;
      const thumb = document.getElementById("thumbnail");
      if(data.thumbnail_url){ thumb.src = data.thumbnail_url; }

      const tagsDiv = document.getElementById("tags");
      if(data.tags && data.tags.length>0){
        tagsDiv.innerHTML = data.tags.map(t=>`<span class="tag">${t}</span>`).join("");
      }

      const url = window.location.href;
      document.getElementById("shareX").href = "https://twitter.com/share?url="+encodeURIComponent(url);
      document.getElementById("shareFb").href = "https://www.facebook.com/sharer/sharer.php?u="+encodeURIComponent(url);
      document.getElementById("shareLine").href = "https://social-plugins.line.me/lineit/share?url="+encodeURIComponent(url);
      document.getElementById("shareIg").href = "https://www.instagram.com/"; // Instagramは直接シェア不可
      document.getElementById("shareMail").href = "mailto:?subject="+encodeURIComponent(data.title)+"&body="+encodeURIComponent(url);

      // 前後記事リンク
      const { data: allArticles } = await supabase.from("articles").select("id, slug, title, created_at").order("created_at",{ascending:false});
      const idx = allArticles.findIndex(a => a.slug===slug);
      if(idx>0){
        const prev = allArticles[idx-1];
        document.getElementById("prevArticle").href = "/blog-detail.html?slug="+prev.slug;
        document.getElementById("prevArticle2").href = "/blog-detail.html?slug="+prev.slug;
      } else {
        document.getElementById("prevArticle").style.visibility="hidden";
        document.getElementById("prevArticle2").style.visibility="hidden";
      }
      if(idx<allArticles.length-1){
        const next = allArticles[idx+1];
        document.getElementById("nextArticle").href = "/blog-detail.html?slug="+next.slug;
        document.getElementById("nextArticle2").href = "/blog-detail.html?slug="+next.slug;
      } else {
        document.getElementById("nextArticle").style.visibility="hidden";
        document.getElementById("nextArticle2").style.visibility="hidden";
      }
    }
    loadArticle();
  </script>
</body>
</html>
