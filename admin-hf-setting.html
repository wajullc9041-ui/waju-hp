<!-- ===== 管理：ヘッダー・フッター編集 ===== -->
<div id="hf-settings-root">
  <h2>ヘッダー・フッター設定</h2>

  <div class="hf-section">
    <h3>ヘッダー設定</h3>
    <div class="form-group">
      <label for="headerHtml">HTML</label>
      <textarea id="headerHtml" rows="8" placeholder="ここにヘッダーHTMLを入力"></textarea>
    </div>
    <div class="form-group">
      <label for="headerCss">CSS</label>
      <textarea id="headerCss" rows="6" placeholder="ここにヘッダーCSSを入力"></textarea>
    </div>
    <button id="saveHeaderBtn" class="btn primary">ヘッダーを保存</button>
  </div>

  <div class="hf-section">
    <h3>フッター設定</h3>
    <div class="form-group">
      <label for="footerHtml">HTML</label>
      <textarea id="footerHtml" rows="8" placeholder="ここにフッターHTMLを入力"></textarea>
    </div>
    <div class="form-group">
      <label for="footerCss">CSS</label>
      <textarea id="footerCss" rows="6" placeholder="ここにフッターCSSを入力"></textarea>
    </div>
    <button id="saveFooterBtn" class="btn success">フッターを保存</button>
  </div>

  <div id="toast-container"></div>
</div>

<style>
  #hf-settings-root {
    padding: 20px;
    font-family: "Segoe UI", sans-serif;
    color: #1f2937;
  }
  h2 {
    margin-top: 0;
    font-size: 22px;
    color: #111827;
  }
  h3 {
    font-size: 18px;
    color: #374151;
    margin-bottom: 0.5rem;
  }
  .hf-section {
    background: #fff;
    border-radius: 8px;
    padding: 16px;
    margin-bottom: 20px;
    box-shadow: 0 2px 6px rgba(0,0,0,0.05);
  }
  .form-group {
    margin-bottom: 12px;
  }
  label {
    display: block;
    font-weight: 600;
    margin-bottom: 4px;
  }
  textarea {
    width: 100%;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    padding: 8px;
    font-family: monospace;
    resize: vertical;
  }
  .btn {
    border: none;
    border-radius: 6px;
    padding: 8px 16px;
    font-size: 14px;
    cursor: pointer;
    color: white;
    transition: background 0.2s, transform 0.1s;
  }
  .btn.primary { background-color: #2563eb; }
  .btn.success { background-color: #10b981; }
  .btn:hover { transform: translateY(-1px); }
  #toast-container {
    position: fixed;
    top: 1rem;
    right: 1rem;
    z-index: 9999;
  }
  .toast {
    margin-bottom: 10px;
    padding: 10px 16px;
    border-radius: 4px;
    color: white;
    font-weight: 500;
    box-shadow: 0 2px 6px rgba(0,0,0,0.2);
    animation: fadeInOut 3s forwards;
  }
  .toast.success { background-color: #10b981; }
  .toast.error { background-color: #ef4444; }
  @keyframes fadeInOut {
    0% { opacity: 0; transform: translateY(-10px); }
    10% { opacity: 1; transform: translateY(0); }
    90% { opacity: 1; }
    100% { opacity: 0; transform: translateY(-10px); }
  }
</style>

<script type="module">
  import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";

  // ===== Supabase接続（env.js対応） =====
  const supabase = createClient(
    window.env.NEXT_PUBLIC_SUPABASE_URL,
    window.env.NEXT_PUBLIC_SUPABASE_ANON_KEY
  );

  // ===== 認証チェック =====
  const { data: { session } } = await supabase.auth.getSession();
  if (!session) {
    window.location.href = "/admin-index.html";
  }

  const toast = (msg, type="success") => {
    const t = document.createElement("div");
    t.className = "toast " + type;
    t.textContent = msg;
    document.getElementById("toast-container").appendChild(t);
    setTimeout(() => t.remove(), 3000);
  };

  async function loadHF() {
    const { data, error } = await supabase.from("hf_settings").select("*");
    if (error) { console.error(error); toast("読み込み失敗","error"); return; }

    const header = data.find(r => r.area === "header");
    const footer = data.find(r => r.area === "footer");

    if (header) {
      document.getElementById("headerHtml").value = header.headerHtml || "";
      document.getElementById("headerCss").value = header.headerCss || "";
    }
    if (footer) {
      document.getElementById("footerHtml").value = footer.footerHtml || "";
      document.getElementById("footerCss").value = footer.footerCss || "";
    }
  }

  async function save(area) {
    const htmlVal = document.getElementById(`${area}Html`).value.trim();
    const cssVal  = document.getElementById(`${area}Css`).value.trim();

    const { error } = await supabase.from("hf_settings").upsert([
      {
        area,
        [`${area}Html`]: htmlVal,
        [`${area}Css`]: cssVal,
        updated_at: new Date().toISOString()
      }
    ]);
    if (error) {
      console.error(error);
      toast(`${area === "header" ? "ヘッダー" : "フッター"}保存失敗`, "error");
    } else {
      toast(`${area === "header" ? "ヘッダー" : "フッター"}を保存しました`);
    }
  }

  document.getElementById("saveHeaderBtn").addEventListener("click", () => save("header"));
  document.getElementById("saveFooterBtn").addEventListener("click", () => save("footer"));

  loadHF();
</script>
