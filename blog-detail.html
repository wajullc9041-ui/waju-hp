<!DOCTYPE html>
<html lang="ja">
<head>
  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZHLJ5K19ZE"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-ZHLJ5K19ZE');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ブログ詳細 | 合同会社WaJu</title>

  <!-- SEO / OGP -->
  <meta name="description" content="合同会社WaJuのブログ詳細ページです。CARELAYや介護・福祉業界に関する最新情報をお届けします。" />
  <meta name="keywords" content="合同会社WaJu, CARELAY, 介護, 福祉, 業界ニュース, コラム, 求人, 地域連携" />
  <meta property="og:title" content="ブログ詳細 | 合同会社WaJu" />
  <meta property="og:description" content="CARELAYや介護・福祉業界に関する最新情報・コラムを掲載しています。" />
  <meta property="og:image" content="https://htnmjsqgoapvuanrsuma.supabase.co/storage/v1/object/public/assets/wjhp0006.png" />
  <meta property="og:url" content="https://waju.co.jp/blog-detail.html" />
  <meta property="og:type" content="article" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:site" content="@waju_corp" />
  <meta name="language" content="ja" />
  <meta name="geo.placename" content="Kobe, Japan" />

  <!-- Favicon / PWA -->
  <link rel="icon" type="image/png" sizes="32x32" href="https://htnmjsqgoapvuanrsuma.supabase.co/storage/v1/object/public/assets/favicon-32x32.png?v=1">
  <link rel="icon" type="image/png" sizes="16x16" href="https://htnmjsqgoapvuanrsuma.supabase.co/storage/v1/object/public/assets/favicon-16x16.png?v=1">
  <link rel="apple-touch-icon" sizes="180x180" href="https://htnmjsqgoapvuanrsuma.supabase.co/storage/v1/object/public/assets/apple-touch-icon.png?v=1">
  <link rel="manifest" href="https://htnmjsqgoapvuanrsuma.supabase.co/storage/v1/object/public/assets/site.webmanifest?v=1">
  <meta name="theme-color" content="#0f172a">

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { sans: ['Inter', 'Noto Sans JP', 'sans-serif'] },
          colors: {
            'waju-primary': '#1e40af',
            'waju-light': '#eff6ff',
            'waju-accent': '#f59e0b'
          }
        }
      }
    }
  </script>

  <!-- FOUC防止 -->
  <style>body{visibility:hidden;}</style>
</head>

<body id="page-body" class="font-sans bg-gray-50" onload="document.body.style.visibility='visible'">
  <header id="site-header"></header>

  <main id="page-main" class="max-w-4xl mx-auto px-6 py-12 sm:py-20 bg-white rounded-xl shadow-lg mt-8 mb-20">
    <article id="blog-article">
      <h1 id="post-title" class="text-3xl sm:text-4xl font-extrabold text-waju-primary mb-6 text-center"></h1>
      <div id="post-meta" class="text-center text-gray-500 mb-10"></div>
      <div id="post-content" class="prose prose-lg max-w-none text-gray-800 leading-relaxed"></div>

      <!-- シェアボタン -->
      <div class="mt-12 border-t pt-6 flex flex-wrap justify-center gap-4 text-sm text-gray-600">
        <button id="share-twitter" class="flex items-center gap-2 px-4 py-2 border rounded-full hover:bg-waju-light transition">
          <i data-lucide="twitter" class="w-5 h-5"></i> Xで共有
        </button>
        <button id="share-facebook" class="flex items-center gap-2 px-4 py-2 border rounded-full hover:bg-waju-light transition">
          <i data-lucide="facebook" class="w-5 h-5"></i> Facebookで共有
        </button>
        <button id="share-copy" class="flex items-center gap-2 px-4 py-2 border rounded-full hover:bg-waju-light transition">
          <i data-lucide="copy" class="w-5 h-5"></i> URLをコピー
        </button>
      </div>

      <!-- 前後記事リンク -->
      <div class="mt-16 flex justify-between text-waju-primary font-semibold">
        <a id="prev-article" href="#" class="hover:underline">← 前の記事</a>
        <a id="next-article" href="#" class="hover:underline">次の記事 →</a>
      </div>
    </article>
  </main>

  <footer id="site-footer"></footer>

  <!-- Lucide Icons -->
  <script src="https://unpkg.com/lucide@latest"></script>

  <!-- Supabase環境変数・ヘッダーフッター -->
  <script src="/env.js"></script>
  <script type="module" src="/hf.js"></script>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
    const sb = createClient(window.env.NEXT_PUBLIC_SUPABASE_URL, window.env.NEXT_PUBLIC_SUPABASE_ANON_KEY);

    const $ = s => document.querySelector(s);
    const titleEl = $("#post-title");
    const metaEl = $("#post-meta");
    const contentEl = $("#post-content");

    async function loadArticle() {
      const params = new URLSearchParams(window.location.search);
      const slug = params.get("slug");
      if (!slug) return;

      const { data, error } = await sb.from("articles").select("*").eq("slug", slug).single();
      if (error) return console.error(error);
      if (!data) return;

      titleEl.textContent = data.title;
      const date = new Date(data.created_at).toLocaleDateString('ja-JP');
      metaEl.textContent = `${date} ｜ ${data.category || "コラム"}`;
      contentEl.innerHTML = data.content || "<p>本文がありません。</p>";

      // 前後の記事
      const { data: all } = await sb.from("articles").select("slug,title,created_at").order("created_at", { ascending: false });
      if (all) {
        const idx = all.findIndex(a => a.slug === slug);
        if (idx > 0) $("#next-article").href = `/blog-detail.html?slug=${all[idx - 1].slug}`;
        if (idx < all.length - 1) $("#prev-article").href = `/blog-detail.html?slug=${all[idx + 1].slug}`;
      }

      lucide.createIcons();
    }

    // 共有ボタン
    $("#share-twitter").addEventListener("click", () => {
      const url = encodeURIComponent(location.href);
      window.open(`https://twitter.com/intent/tweet?url=${url}`, "_blank");
    });
    $("#share-facebook").addEventListener("click", () => {
      const url = encodeURIComponent(location.href);
      window.open(`https://www.facebook.com/sharer/sharer.php?u=${url}`, "_blank");
    });
    $("#share-copy").addEventListener("click", async () => {
      await navigator.clipboard.writeText(location.href);
      alert("URLをコピーしました");
    });

    window.addEventListener("load", loadArticle);
  </script>
</body>
</html>
