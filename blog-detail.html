<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ブログ詳細 | 合同会社WaJu</title>
  <meta name="description" content="合同会社WaJuのブログ詳細ページです。CARELAYや介護・福祉業界に関する最新情報をお届けします。" />

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-R49H9DTN70"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-R49H9DTN70');
  </script>

  <style>
    :root {
      --blue:#0d6efd;
      --gray-100:#f8f9fa;
      --gray-200:#e9ecef;
      --gray-300:#dee2e6;
      --gray-600:#6c757d;
    }
    html,body {
      margin:0;
      padding:0;
      background:var(--gray-100);
      font-family:"Noto Sans JP",system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Helvetica Neue","Hiragino Kaku Gothic ProN","BIZ UDPGothic","Meiryo",sans-serif;
      color:#111;
    }
    header,footer{min-height:56px}
    main{max-width:960px;margin:0 auto;padding:24px;box-sizing:border-box;}

    /* ---------- 記事ヘッダー（カード化） ---------- */
    .title-wrap{
      display:flex;
      gap:16px;
      align-items:flex-start;
      margin:16px 0 8px;
      background:#fff;
      border:1px solid var(--gray-300);
      border-radius:12px;
      box-shadow:0 2px 6px rgba(0,0,0,.08);
      padding:16px;
    }
    .thumb{width:100px;height:100px;border:1px solid var(--gray-300);border-radius:8px;object-fit:contain;background:#fff;}
    h1{font-size:1.8rem;line-height:1.3;margin:0 0 6px;font-weight:700;}
    .meta{color:var(--gray-600);font-size:.9rem;margin-bottom:8px}
    .cat{display:inline-block;background:#e7f1ff;color:#0b5ed7;font-size:.75rem;border-radius:999px;padding:3px 8px;margin-left:4px}

    /* ---------- ナビゲーション ---------- */
    .post-nav {
      max-width: 720px;
      margin: 18px auto;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:16px;
      background:var(--gray-100);
      border:1px solid var(--gray-300);
      border-radius:8px;
      padding:8px 12px;
    }
    .nav-link{display:flex;align-items:center;gap:8px;color:var(--blue);text-decoration:none;font-weight:600}
    .nav-link.center{color:#111;}
    .nav-ico{width:32px;height:32px;display:inline-flex;align-items:center;justify-content:center;border-radius:999px;background:#e7f1ff}

    /* ---------- 本文 ---------- */
    .content{
      background:#fff;
      border-radius:12px;
      box-shadow:0 2px 6px rgba(0,0,0,.05);
      padding:20px;
      min-height:48px;
    }

    /* ---------- タグ ---------- */
    .tags{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      margin:18px 0;
      border-top:1px solid var(--gray-300);
      border-bottom:1px solid var(--gray-300);
      padding:8px 0;
    }
    .tag{
      background:#f1f3f5;
      color:#333;
      border-radius:999px;
      padding:4px 10px;
      font-size:.8rem;
    }

    /* ---------- シェアボタン（右寄せ） ---------- */
    .share{
      display:flex;
      justify-content:flex-end;
      align-items:center;
      gap:12px;
      margin:12px 0 20px;
    }
    .share .label{
      color:#555;
      font-size:.9rem;
      margin-right:0;
    }
    .sbtn{width:40px;height:40px;border-radius:999px;display:inline-flex;align-items:center;justify-content:center;color:#fff;text-decoration:none}
    .sbtn svg{width:20px;height:20px;display:block}
    .sbtn.x{background:#000}
    .sbtn.fb{background:#1877f2}
    .sbtn.line{background:#06c755}
    .sbtn.ig{background:#e1306c}
    .sbtn.mail{background:#fbbc05;color:#000}

    /* ---------- スマホ対応 ---------- */
    @media (max-width:640px){
      .title-wrap{align-items:center;margin-left:0;margin-right:0;}
      .content,.tags,.share,.post-nav{margin-left:0;margin-right:0;}
      .thumb{width:84px;height:84px}
      h1{font-size:1.5rem}
    }
  </style>
</head>
<body>
  <header id="site-header"></header>

  <main id="page-main">
    <!-- 上ナビ -->
    <nav class="post-nav" aria-label="記事ナビゲーション 上">
      <a id="prevTop" class="nav-link" href="#">
        <span class="nav-ico" aria-hidden="true">⬅</span><span>前の記事</span>
      </a>
      <a class="nav-link center" href="/blog/">
        <span class="nav-ico" aria-hidden="true">🏠</span><span>一覧に戻る</span>
      </a>
      <a id="nextTop" class="nav-link" href="#">
        <span>次の記事</span><span class="nav-ico" aria-hidden="true">➡</span>
      </a>
    </nav>

    <!-- タイトル＆メタ -->
    <div class="title-wrap">
      <img id="postThumb" class="thumb" alt="サムネイル" />
      <div>
        <h1 id="postTitle"></h1>
        <div class="meta">
          <time id="postDate"></time>
          <span id="postCat" class="cat"></span>
        </div>
      </div>
    </div>

    <!-- 本文 -->
    <article id="postContent" class="content"></article>

    <!-- タグ -->
    <div id="postTags" class="tags"></div>

    <!-- シェア -->
    <div class="share">
      <span class="label">シェアする：</span>
      <a id="shareX" class="sbtn x" target="_blank" rel="noopener noreferrer" title="Xでシェア">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.36 2H21l-7.53 9.55L21.5 22h-2.95l-6.07-7.63L6.4 22H3l7.95-10.5L2.5 2h2.95l5.61 7.05L18.36 2z"/></svg>
      </a>
      <a id="shareFb" class="sbtn fb" target="_blank" rel="noopener noreferrer" title="Facebookでシェア">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M22 12a10 10 0 1 0-11.5 9.95v-7.04H8v-2.91h2.5V9.5c0-2.5 1.5-3.9 3.7-3.9 1.07 0 2.2.19 2.2.19v2.4h-1.24c-1.22 0-1.6.76-1.6 1.54v1.85H16l-.4 2.91h-2.5v7.04A10 10 0 0 0 22 12z"/></svg>
      </a>
      <a id="shareLine" class="sbtn line" target="_blank" rel="noopener noreferrer" title="LINEでシェア">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M20.7 4.3A10 10 0 0 0 12 2C6.5 2 2 6 2 11c0 2.6 1.2 4.9 3.2 6.5l-.6 3.9 4.1-2.2c1 .3 2 .4 3.2.4 5.5 0 10-4 10-9 0-2.4-1-4.6-2.8-6.3z"/></svg>
      </a>
      <a id="shareIg" class="sbtn ig" target="_blank" rel="noopener noreferrer" title="Instagramへ">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5zm5 5a5 5 0 1 0 .001 10.001A5 5 0 0 0 12 7zm0 2.2a2.8 2.8 0 1 1 0 5.6 2.8 2.8 0 0 1 0-5.6zM18 6.7a1.1 1.1 0 1 0 0 2.2 1.1 1.1 0 0 0 0-2.2z"/></svg>
      </a>
      <a id="shareMail" class="sbtn mail" target="_blank" rel="noopener noreferrer" title="メールで共有">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm0 2v.01L12 13l8-6.99V6H4z"/></svg>
      </a>
    </div>

    <!-- 下ナビ -->
    <nav class="post-nav" aria-label="記事ナビゲーション 下">
      <a id="prevBottom" class="nav-link" href="#">
        <span class="nav-ico" aria-hidden="true">⬅</span><span>前の記事</span>
      </a>
      <a class="nav-link center" href="/blog/">
        <span class="nav-ico" aria-hidden="true">🏠</span><span>一覧に戻る</span>
      </a>
      <a id="nextBottom" class="nav-link" href="#">
        <span>次の記事</span><span class="nav-ico" aria-hidden="true">➡</span>
      </a>
    </nav>
  </main>

  <footer id="site-footer"></footer>

  <script src="/env.js"></script>
  <script type="module" src="/hf.js"></script>

  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
    const sb = createClient(
      window.env.NEXT_PUBLIC_SUPABASE_URL,
      window.env.NEXT_PUBLIC_SUPABASE_ANON_KEY,
      { auth: { persistSession: false, autoRefreshToken: false, storageKey: "sb-waju-blog" } }
    );
    const $ = (s) => document.querySelector(s);
    function fmt(d){ try{ return new Date(d).toLocaleDateString(); }catch{return ""} }

    async function load(){
      const params = new URLSearchParams(location.search);
      const slug = params.get("slug");
      if(!slug){ $("#postTitle").textContent = "記事が見つかりません"; return; }

      const { data, error } = await sb.from("articles").select("*").eq("slug", slug).single();
      if(error){ console.error("記事取得エラー:", error); $("#postTitle").textContent="記事の取得に失敗しました"; return; }

      $("#postTitle").textContent = data.title || "";
      $("#postDate").textContent = fmt(data.created_at);
      $("#postCat").textContent = data.category || "";
      $("#postThumb").src = data.thumbnail_url || "";
      $("#postThumb").alt = (data.title || "サムネイル") + "の画像";
      $("#postContent").innerHTML = data.content || "";

      const tagWrap = $("#postTags");
      tagWrap.innerHTML = "";
      if(Array.isArray(data.tags)){
        for(const t of data.tags){
          const span = document.createElement("span");
          span.className = "tag";
          span.textContent = "#" + t;
          tagWrap.appendChild(span);
        }
      }

      const u = encodeURIComponent(location.href);
      const t = encodeURIComponent(data.title || document.title);
      $("#shareX").href = `https://twitter.com/intent/tweet?url=${u}&text=${t}`;
      $("#shareFb").href = `https://www.facebook.com/sharer/sharer.php?u=${u}`;
      $("#shareLine").href = `https://social-plugins.line.me/lineit/share?url=${u}`;
      $("#shareIg").href = `https://www.instagram.com/?url=${u}`;
      $("#shareMail").href = `mailto:?subject=${t}&body=${t}%0D%0A${u}`;

      const { data: newer } = await sb.from("articles").select("title,slug,created_at").gt("created_at", data.created_at).order("created_at",{ascending:true}).limit(1);
      const { data: older } = await sb.from("articles").select("title,slug,created_at").lt("created_at", data.created_at).order("created_at",{ascending:false}).limit(1);

      for(const id of ["prevTop","prevBottom"]){
        const a=$("#"+id);
        if(older && older.length){
          a.href="/blog-detail.html?slug="+older[0].slug;
          a.title="← "+older[0].title;
        }else{ a.classList.add("disabled"); a.style.opacity=".4"; a.style.pointerEvents="none"; }
      }
      for(const id of ["nextTop","nextBottom"]){
        const a=$("#"+id);
        if(newer && newer.length){
          a.href="/blog-detail.html?slug="+newer[0].slug;
          a.title=newer[0].title+" →";
        }else{ a.classList.add("disabled"); a.style.opacity=".4"; a.style.pointerEvents="none"; }
      }
    }
    load();
  </script>
</body>
</html>
