<div id="hf-admin-root">
  <h2>ヘッダー & フッター 管理</h2>

  <!-- ヘッダー設定 -->
  <section class="panel">
    <div class="panel-head">
      <h3>ヘッダー プレビュー</h3>
      <button id="saveHeaderBtn" class="btn primary">保存</button>
    </div>
    <div id="headerPreview" class="preview-surface"></div>
    <div class="edit-grid">
      <div class="field"><label>会社名</label><input id="company_name" /></div>
      <div class="field"><label>ロゴURL</label><input id="logo_url" /></div>
      <div class="field"><label>ロゴ高さ(px)</label><input type="number" id="logo_height" /></div>
      <div class="field"><label>ロゴ位置</label><select id="logo_alignment"><option>left</option><option>center</option><option>right</option></select></div>
      <div class="field"><label>会社名位置</label><select id="company_alignment"><option>left</option><option>center</option><option>right</option></select></div>
      <div class="field"><label>ナビ位置</label><select id="nav_alignment"><option>left</option><option>center</option><option>right</option></select></div>
      <div class="field"><label>背景色</label><input type="color" id="bg_color" /></div>
      <div class="field"><label>背景グラデーション</label><input id="bg_gradient" placeholder="linear-gradient(...)" /></div>
      <div class="field"><label>文字色</label><input type="color" id="text_color" /></div>
      <div class="field"><label>フォント</label><input id="font_family" placeholder="Noto Sans JP" /></div>
      <div class="field"><label>文字サイズ</label><input type="number" id="font_size" /></div>
      <div class="field"><label>文字太さ</label><select id="font_weight"><option>normal</option><option>bold</option></select></div>
      <div class="field"><label>リンク間隔</label><input type="number" id="link_spacing" /></div>
      <div class="field"><label>パディング</label><input id="padding" /></div>
    </div>
  </section>

  <!-- フッター設定 -->
  <section class="panel">
    <div class="panel-head">
      <h3>フッター プレビュー</h3>
      <button id="saveFooterBtn" class="btn primary">保存</button>
    </div>
    <div id="footerPreview" class="preview-surface"></div>
    <div class="edit-grid">
      <div class="field"><label>コピーライト</label><input id="footer_text" /></div>
      <div class="field"><label>配置</label><select id="footer_alignment"><option>left</option><option>center</option><option>right</option></select></div>
      <div class="field"><label>背景色</label><input type="color" id="bg_color_footer" /></div>
      <div class="field"><label>背景グラデーション</label><input id="bg_gradient_footer" /></div>
      <div class="field"><label>文字色</label><input type="color" id="text_color_footer" /></div>
      <div class="field"><label>フォント</label><input id="font_family_footer" /></div>
      <div class="field"><label>文字サイズ</label><input type="number" id="font_size_footer" /></div>
      <div class="field"><label>文字太さ</label><select id="font_weight_footer"><option>normal</option><option>bold</option></select></div>
      <div class="field"><label>リンク間隔</label><input type="number" id="link_spacing_footer" /></div>
      <div class="field"><label>固定表示</label><input type="checkbox" id="footer_fixed" /></div>
      <div class="field"><label>パディング</label><input id="padding_footer" /></div>
    </div>
  </section>

  <!-- メニュー管理 -->
  <section class="panel">
    <div class="panel-head"><h3>メニュー管理</h3></div>
    <table id="menuTable"><thead><tr><th>ID</th><th>タイトル</th><th>URL</th><th>Header</th><th>Footer</th></tr></thead><tbody></tbody></table>
  </section>
</div>

<script type="module">
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm";
const supabase = createClient("https://htnmjsqgoapvuanrsuma.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imh0bm1qc3Fnb2FwdnVhbnJzdW1hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTUzMzI3MDEsImV4cCI6MjA3MDkwODcwMX0.1AACTWZmChfmIIfBad0sf-hLV2bnaUt7bVURXnd0uKA");

async function loadSettings(area){
  let {data,error}=await supabase.from("hf_settings").select("*").eq("area",area).single();
  if(error && error.code==="PGRST116"){
    await supabase.from("hf_settings").insert({area});
    ({data}=await supabase.from("hf_settings").select("*").eq("area",area).single());
  }
  return data;
}
async function saveSettings(area,values){
  await supabase.from("hf_settings").upsert({...values,area});
}
function renderHeader(data){
  const el=document.getElementById("headerPreview");
  el.innerHTML=`<header style="background:${data.bg_gradient||data.bg_color};color:${data.text_color};font-family:${data.font_family};font-size:${data.font_size}px;font-weight:${data.font_weight};padding:${data.padding};display:flex;justify-content:space-between;align-items:center;">
    <div style="text-align:${data.logo_alignment};"><img src="${data.logo_url||''}" style="height:${data.logo_height}px"></div>
    <div style="text-align:${data.company_alignment};">${data.company_name||''}</div>
    <nav style="text-align:${data.nav_alignment};gap:${data.link_spacing}px;">メニュー</nav>
  </header>`;
}
function renderFooter(data){
  const el=document.getElementById("footerPreview");
  el.innerHTML=`<footer style="background:${data.bg_gradient||data.bg_color};color:${data.text_color};font-family:${data.font_family};font-size:${data.font_size}px;font-weight:${data.font_weight};padding:${data.padding};text-align:${data.footer_alignment};">
    ${data.footer_text||''}
  </footer>`;
}

async function init(){
  const header=await loadSettings("header"); renderHeader(header);
  const footer=await loadSettings("footer"); renderFooter(footer);
  // メニュー読込
  let {data:menus}=await supabase.from("public_menus").select("*").order("sort_order");
  const tbody=document.querySelector("#menuTable tbody");
  tbody.innerHTML=menus.map(m=>`<tr><td>${m.id}</td><td>${m.title}</td><td>${m.url}</td><td>${m.show_header}</td><td>${m.show_footer}</td></tr>`).join("");
}
init();

document.getElementById("saveHeaderBtn").onclick=async()=>{
  const values={
    company_name:company_name.value,
    logo_url:logo_url.value,
    logo_height:+logo_height.value,
    logo_alignment:logo_alignment.value,
    company_alignment:company_alignment.value,
    nav_alignment:nav_alignment.value,
    bg_color:bg_color.value,
    bg_gradient:bg_gradient.value,
    text_color:text_color.value,
    font_family:font_family.value,
    font_size:+font_size.value,
    font_weight:font_weight.value,
    link_spacing:+link_spacing.value,
    padding:padding.value
  };
  await saveSettings("header",values);
  renderHeader(values);
};
document.getElementById("saveFooterBtn").onclick=async()=>{
  const values={
    footer_text:footer_text.value,
    footer_alignment:footer_alignment.value,
    bg_color:bg_color_footer.value,
    bg_gradient:bg_gradient_footer.value,
    text_color:text_color_footer.value,
    font_family:font_family_footer.value,
    font_size:+font_size_footer.value,
    font_weight:font_weight_footer.value,
    link_spacing:+link_spacing_footer.value,
    footer_fixed:footer_fixed.checked,
    padding:padding_footer.value
  };
  await saveSettings("footer",values);
  renderFooter(values);
};
</script>
